<!DOCTYPE html>
<html lang="ky">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Админ панель</title>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0-beta3/css/all.min.css">
    <link rel="stylesheet" href="/css/adminPage.css">
</head>
<body>
    <div id="include-header"></div>
    
    <div class="admin-container">
        <aside class="admin-sidebar">
            <h3>Админ панель</h3>
            <ul class="admin-menu">
                <li><a href="#" class="menu-link active" data-section="news"><i class="fas fa-newspaper"></i> Жаңылыктар</a></li>
                <li><a href="#" class="menu-link" data-section="teachers"><i class="fas fa-chalkboard-teacher"></i> Мугалимдер</a></li>
                <li><a href="#" class="menu-link" data-section="students"><i class="fas fa-user-graduate"></i> Окуучулар</a></li>
            </ul>
        </aside>
        
        <main class="admin-content">
            <!-- Новости -->
            <div id="news-section" class="content-section active">
                <div class="admin-header">
                    <h2><i class="fas fa-newspaper"></i> Жаңылыктарды башкаруу</h2>
                    <button class="btn btn-add" id="addNewsBtn">
                        <i class="fas fa-plus"></i> Жаңы жаңылык
                    </button>
                </div>
                
                <table class="news-table">
                    <thead>
                        <tr>
                            <th>ID</th>
                            <th>Сүрөт</th>
                            <th>Аталышы</th>
                            <th>Дата</th>
                            <th>Категория</th>
                            <th>Аракеттер</th>
                        </tr>
                    </thead>
                    <tbody id="newsTableBody"></tbody>
                </table>
            </div>
            
            <!-- Преподаватели -->
            <div id="teachers-section" class="content-section">
                <div class="admin-header">
                    <h2><i class="fas fa-chalkboard-teacher"></i> Мугалимдерди башкаруу</h2>
                    <button class="btn btn-add" id="addTeacherBtn">
                        <i class="fas fa-plus"></i> Мугалим кошуу
                    </button>
                </div>
                
                <table class="news-table">
                    <thead>
                        <tr>
                            <th>ID</th>
                            <th>Сүрөт</th>
                            <th>Аты-жөнү</th>
                            <th>Адистиги</th>
                            <th>Стаж</th>
                            <th>Аракеттер</th>
                        </tr>
                    </thead>
                    <tbody id="teachersTableBody"></tbody>
                </table>
            </div>

            <div id="students-section" class="content-section" style="display: none;">
              <div class="admin-header">
                <h2><i class="fas fa-user-graduate"></i> Окуучуларды башкаруу</h2>
                <button class="btn btn-add" id="addStudentBtn">
                  <i class="fas fa-plus"></i> Окуучу кошуу
                </button>
              </div>
            
              <div class="students-grid" id="studentsGrid"></div>
            </div>
            
            <!-- Модальное окно для студентов -->
            <div class="modal" id="studentModal">
              <div class="modal-content">
                <div class="modal-header">
                  <h3 id="studentModalTitle">Окуучу кошуу</h3>
                  <button class="close-modal">&times;</button>
                </div>
                <div class="modal-body">
                  <form id="studentForm">
                    <div class="form-group">
                      <label>Аты-жөнү:</label>
                      <input type="text" id="studentName" class="form-control" required>
                    </div>
                    <div class="form-group">
                      <label>Класс:</label>
                      <input type="text" id="studentClass" class="form-control" required>
                    </div>
                    <div class="form-group">
                      <label>Жетишкендиктер:</label>
                      <input type="text" id="studentAchievements" class="form-control" required>
                    </div>
                    <div class="form-group">
                      <label>Сүрөттөмө:</label>
                      <textarea id="studentDescription" class="form-control" required></textarea>
                    </div>
                    <div class="form-group">
                      <label>Белгилер (чекит менен бөлүңүз):</label>
                      <input type="text" id="studentBadges" class="form-control" placeholder="Математика, Информатика, Спорт">
                    </div>
                    <div class="form-group">
                      <label>Сүрөт:</label>
                      <input type="file" id="studentImage" class="form-control">
                    </div>
                  </form>
                </div>
                <div class="modal-footer">
                  <button class="btn" id="cancelStudentBtn">Жокко чыгаруу</button>
                  <button class="btn btn-add" id="saveStudentBtn">Сактоо</button>
                </div>
              </div>
            </div>
        </main>
    </div>
    
    <!-- Модальное окно новостей -->
    <div class="modal" id="newsModal">
        <div class="modal-content">
            <div class="modal-header">
                <h3 id="newsModalTitle">Жаңы жаңылык кошуу</h3>
                <button class="close-modal">&times;</button>
            </div>
            <div class="modal-body">
                <form id="newsForm">
                    <div class="form-group">
                        <label>Аталышы:</label>
                        <input type="text" id="newsTitle" class="form-control" required>
                    </div>
                    <div class="form-group">
                        <label>Категория:</label>
                        <select id="newsCategory" class="form-control" required>
                            <option value="">Категорияны тандаңыз</option>
                            <option value="Окуу процесси">Окуу процесси</option>
                            <option value="Иш-чаралар">Иш-чаралар</option>
                            <option value="Спорт">Спорт</option>
                            <option value="Жетишкендиктер">Жетишкендиктер</option>
                        </select>
                    </div>
                    <div class="form-group">
                        <label>Дата:</label>
                        <input type="date" id="newsDate" class="form-control" required>
                    </div>
                    <div class="form-group">
                        <label>Сүрөт:</label>
                        <input type="file" id="newsImage" class="form-control">
                    </div>
                    <div class="form-group">
                        <label>Мазмуну:</label>
                        <textarea id="newsContent" class="form-control" required></textarea>
                    </div>
                </form>
            </div>
            <div class="modal-footer">
                <button class="btn" id="cancelNewsBtn">Жокко чыгаруу</button>
                <button class="btn btn-add" id="saveNewsBtn">Сактоо</button>
            </div>
        </div>
    </div>
    
    <!-- Модальное окно преподавателей -->
    <div class="modal" id="teacherModal">
        <div class="modal-content">
            <div class="modal-header">
                <h3 id="teacherModalTitle">Мугалим кошуу</h3>
                <button class="close-modal">&times;</button>
            </div>
            <div class="modal-body">
                <form id="teacherForm">
                    <div class="form-group">
                        <label>Аты-жөнү:</label>
                        <input type="text" id="teacherName" class="form-control" required>
                    </div>
                    <div class="form-group">
                        <label>Адистиги:</label>
                        <input type="text" id="teacherSubject" class="form-control" required>
                    </div>
                    <div class="form-group">
                        <label>Стажы:</label>
                        <input type="text" id="teacherExperience" class="form-control" required>
                    </div>
                    <div class="form-group">
                        <label>Билими:</label>
                        <input type="text" id="teacherEducation" class="form-control" required>
                    </div>
                    <div class="form-group">
                        <label>Кыскача маалымат:</label>
                        <textarea id="teacherBio" class="form-control"></textarea>
                    </div>
                    <div class="form-group">
                        <label>Сүрөт:</label>
                        <input type="file" id="teacherPhoto" class="form-control">
                    </div>
                </form>
            </div>
            <div class="modal-footer">
                <button class="btn" id="cancelTeacherBtn">Жокко чыгаруу</button>
                <button class="btn btn-add" id="saveTeacherBtn">Сактоо</button>
            </div>
        </div>
    </div>
    <script src="/js/admin.js"></script>
    <script src="/js/include.js"></script>
</body>

<script>
  document.querySelectorAll('.menu-link').forEach(link => {
  link.addEventListener('click', function (e) {
    e.preventDefault();

    document.querySelectorAll('.menu-link').forEach(link => link.classList.remove('active'));
    this.classList.add('active');

    document.querySelectorAll('.content-section').forEach(section => section.style.display = 'none');

    const sectionId = this.dataset.section;
    if (sectionId) {
      document.getElementById(`${sectionId}-section`).style.display = 'block';

      if (sectionId === 'students') {
        loadStudents();
      }
    }
  });
});

</script>
    <script>
const studentModal = document.getElementById('studentModal');
const studentForm = document.getElementById('studentForm');
const addStudentBtn = document.getElementById('addStudentBtn');
const saveStudentBtn = document.getElementById('saveStudentBtn');
const cancelStudentBtn = document.getElementById('cancelStudentBtn');
const studentsGrid = document.getElementById('studentsGrid');
let currentStudentId = null;

// Инициализация
addStudentBtn.addEventListener('click', () => {
  studentModal.style.display = 'flex';
  document.getElementById('studentModalTitle').textContent = 'Окуучу кошуу';
  studentForm.reset();
  currentStudentId = null;
});

cancelStudentBtn.addEventListener('click', () => {
  studentModal.style.display = 'none';
});

studentModal.addEventListener('click', (e) => {
  if (e.target === studentModal) studentModal.style.display = 'none';
});

// Загрузка студентов
async function loadStudents() {
  const API_BASE_URL = 'https://n-saidiev.onrender.com';

  try {
    const response = await fetch(`${API_BASE_URL}/api/students`);
    if (!response.ok) throw new Error('Ошибка загрузки');
    
    const students = await response.json();
    renderStudents(students);
  } catch (error) {
    console.error('Ошибка:', error);
    alert('Окуучуларды жүктөө мүмкүн болбоду');
  }
}

// Отображение студентов
function renderStudents(students) {
  const API_BASE_URL = 'https://n-saidiev.onrender.com';

  studentsGrid.innerHTML = students.map(student => `
    <div class="student-card" data-id="${student._id}">
      <div class="student-image">
 <img src="${student.image ? `${student.image}` : 'img/default-student.png'}" 
     alt="${student.name}"
     width="60" 
     height="60">
        <div class="student-actions">
          <button class="btn btn-edit" data-id="${student._id}"><i class="fas fa-edit"></i></button>
          <button class="btn btn-delete" data-id="${student._id}"><i class="fas fa-trash"></i></button>
        </div>
      </div>
      <div class="student-info">
        <h3>${student.name}</h3>
        <span class="class">${student.class} класс</span>
        <span class="achievement">${student.achievements}</span>
        <p>${student.description}</p>
        <div class="badges">
          ${student.badges.map(badge => `<span class="badge">${badge}</span>`).join('')}
        </div>
      </div>
    </div>
  `).join('');

  // Навешиваем обработчики
  document.querySelectorAll('.student-card .btn-edit').forEach(btn => {
    btn.addEventListener('click', () => editStudent(btn.dataset.id));
  });

  document.querySelectorAll('.student-card .btn-delete').forEach(btn => {
    btn.addEventListener('click', () => deleteStudent(btn.dataset.id));
  });
}
async function editStudent(id) {
  const API_BASE_URL = 'https://n-saidiev.onrender.com';

  try {
    console.log('Fetching student with ID:', id);
    
    const response = await fetch(`${API_BASE_URL}/api/students/${id}`, {
      headers: {
        'Accept': 'application/json'
      }
    });

    
    // Проверяем Content-Type перед парсингом
    const contentType = response.headers.get('content-type');
    if (!contentType || !contentType.includes('application/json')) {
      const text = await response.text();
      throw new Error(`Ожидался JSON, получено: ${text.substring(0, 100)}...`);
    }
    
    if (!response.ok) {
      const errorData = await response.json().catch(() => null);
      throw new Error(errorData?.error || `HTTP error! status: ${response.status}`);
    }
    
    const student = await response.json();
    console.log('Received student data:', student);
    
    // Заполнение формы остается без изменений
    document.getElementById('studentName').value = student.name;
    document.getElementById('studentClass').value = student.class;
    document.getElementById('studentAchievements').value = student.achievements;
    document.getElementById('studentDescription').value = student.description;
    document.getElementById('studentBadges').value = student.badges?.join(', ') || '';
    
    currentStudentId = id;
    document.getElementById('studentModalTitle').textContent = 'Окуучуну түзөтүү';
    studentModal.style.display = 'flex';
    
  } catch (error) {
    console.error('Полная ошибка:', {
      message: error.message,
      stack: error.stack
    });
    alert(`Түзөтүү мүмкүн болбоду: ${error.message}`);
  }
}
saveStudentBtn.addEventListener('click', async () => {
  const API_BASE_URL = 'https://n-saidiev.onrender.com';

  // Валидация полей
  if (!document.getElementById('studentName').value) {
    alert('Введите имя студента');
    return;
  }

  try {
    const formData = new FormData();
    formData.append('name', document.getElementById('studentName').value);
    formData.append('class', document.getElementById('studentClass').value);
    formData.append('achievements', document.getElementById('studentAchievements').value);
    formData.append('description', document.getElementById('studentDescription').value);
    formData.append('badges', document.getElementById('studentBadges').value);

    const imageFile = document.getElementById('studentImage').files[0];
    if (imageFile) {
      if (!imageFile.type.startsWith('image/')) {
        throw new Error('Выберите файл изображения (JPG/PNG)');
      }
      formData.append('image', imageFile);
    }

    const response = await fetch(
      currentStudentId 
        ? `${API_BASE_URL}/api/students/${currentStudentId}`
        : `${API_BASE_URL}/api/students`,
      {
        method: currentStudentId ? 'PUT' : 'POST',
        body: formData
      }
    );

    const text = await response.text();
    let data;
    
    try {
      data = JSON.parse(text);
    } catch {
      throw new Error(`Сервер вернул невалидный JSON: ${text.substring(0, 100)}`);
    }

    if (!response.ok) {
      throw new Error(data.error || 'Неизвестная ошибка сервера');
    }

    studentModal.style.display = 'none';
    loadStudents();
    
  } catch (error) {
    console.error('Ошибка:', error);
    alert(`Ошибка сохранения: ${error.message}`);
  }
});

// Удаление студента
async function deleteStudent(id) {
  const API_BASE_URL = 'https://n-saidiev.onrender.com';

  if (!confirm('Бул окуучуну чынымен өчүрүүнү каалайсызбы?')) return;
  
  try {
    const response = await fetch(`${API_BASE_URL}/api/students/${id}`, {
      method: 'DELETE'
    });
    
    if (!response.ok) throw new Error('Өчүрүү ийгиликсиз болду');
    loadStudents();
    
  } catch (error) {
    console.error('Ошибка:', error);
    alert('Өчүрүү мүмкүн болбоду');
  }
}

loadStudents()
        </script>


  
    <script src="js/include.js"></script>

<script src="/js/translations.js"></script>
<script src="/js/initLanguageSelect.js"></script>
<script src="js/hamburgerMenu.js"></script>

</body>
</html>